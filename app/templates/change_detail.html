{% extends "base.html" %}

{% block title %}Change #{{ change.id }} - ChangeLog{% endblock %}

{% block content %}
<div class="change-detail">
    <div class="page-header">
        <div>
            <h1>Change Record #{{ change.id }}</h1>
            <p class="subtitle">{{ change.title }}</p>
        </div>
        <div class="header-actions">
            <a href="/changes/{{ change.id }}/pdf" class="btn btn-secondary">
                üìÑ Download PDF
            </a>
            <a href="/" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>

    <div class="detail-grid">
        <!-- Status Card -->
        <div class="detail-card">
            <h3>Status</h3>
            <div class="status-info">
                <span class="badge badge-status-{{ change.status.value.lower().replace(' ', '-') }} badge-large">
                    {{ change.status.value }}
                </span>
            </div>
        </div>

        <!-- Metadata Card -->
        <div class="detail-card">
            <h3>Metadata</h3>
            <div class="detail-row">
                <span class="label">Created:</span>
                <span class="value">{{ change.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Created By:</span>
                <span class="value">{{ change.created_by }}</span>
            </div>
            {% if change.updated_at %}
            <div class="detail-row">
                <span class="label">Last Updated:</span>
                <span class="value">{{ change.updated_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Basics Section -->
    <div class="detail-section">
        <h2>Change Details</h2>
        
        <div class="detail-row">
            <span class="label">Category:</span>
            <span class="badge badge-category">{{ change.category.value }}</span>
        </div>
        
        <div class="detail-row">
            <span class="label">Systems Affected:</span>
            <div class="systems-tags">
                {% for system in change.systems_list %}
                <span class="tag">{{ system }}</span>
                {% endfor %}
            </div>
        </div>
        
        <div class="detail-row">
            <span class="label">Implementer:</span>
            <span class="value">{{ change.implementer }}</span>
        </div>
        
        {% if change.planned_start %}
        <div class="detail-row">
            <span class="label">Planned Start:</span>
            <span class="value">{{ change.planned_start.strftime('%Y-%m-%d %H:%M:%S') }}</span>
        </div>
        {% endif %}
        
        {% if change.planned_end %}
        <div class="detail-row">
            <span class="label">Planned End:</span>
            <span class="value">{{ change.planned_end.strftime('%Y-%m-%d %H:%M:%S') }}</span>
        </div>
        {% endif %}
    </div>

    <!-- Risk Assessment Section -->
    <div class="detail-section">
        <h2>Risk Assessment</h2>
        
        <div class="detail-row">
            <span class="label">Impact Level:</span>
            <span class="badge badge-impact-{{ change.impact_level.value.lower() }}">
                {{ change.impact_level.value }}
            </span>
        </div>
        
        <div class="detail-row">
            <span class="label">Expected User Impact:</span>
            <span class="value">{{ change.user_impact.value }}</span>
        </div>
        
        <div class="detail-row">
            <span class="label">Maintenance Window:</span>
            <span class="value">{{ 'Yes' if change.maintenance_window else 'No' }}</span>
        </div>
        
        {% if change.backout_plan %}
        <div class="detail-content">
            <h4>Backout Plan</h4>
            <p class="content-text">{{ change.backout_plan }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Work Details Section -->
    <div class="detail-section">
        <h2>Work Details</h2>
        
        <div class="detail-content">
            <h4>What Changed</h4>
            <p class="content-text">{{ change.what_changed }}</p>
        </div>
        
        {% if change.ticket_id %}
        <div class="detail-row">
            <span class="label">Ticket/Issue ID:</span>
            <span class="value">{{ change.ticket_id }}</span>
        </div>
        {% endif %}
        
        {% if change.links_list %}
        <div class="detail-content">
            <h4>Related Links</h4>
            <ul class="links-list">
                {% for link in change.links_list %}
                <li><a href="{{ link }}" target="_blank" rel="noopener noreferrer">{{ link }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>

    <!-- Completion Section -->
    {% if change.outcome_notes or change.post_change_issues %}
    <div class="detail-section">
        <h2>Completion</h2>
        
        {% if change.outcome_notes %}
        <div class="detail-content">
            <h4>Outcome Notes</h4>
            <p class="content-text">{{ change.outcome_notes }}</p>
        </div>
        {% endif %}
        
        {% if change.post_change_issues %}
        <div class="detail-content">
            <h4>Post-Change Issues</h4>
            <p class="content-text">{{ change.post_change_issues }}</p>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Print View -->
    <div class="print-actions">
        <button onclick="window.print()" class="btn btn-secondary">üñ®Ô∏è Print View</button>
    </div>
</div>

<style>
@media print {
    .navbar, .header-actions, .print-actions, .btn {
        display: none !important;
    }
    
    .change-detail {
        padding: 0;
    }
    
    .detail-section {
        page-break-inside: avoid;
    }
}
</style>
{% endblock %}
